<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<!-- begin::Head -->
<head>
    <title>MFLoan | Docflow</title>
    <div th:replace="fragments/header :: header-css"/>
</head>
<!-- end::Head -->

<!-- end::Body -->
<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default"  >
<!-- begin:: Page -->
<div class="m-grid m-grid--hor m-grid--root m-page">
    <!-- BEGIN: Header -->
    <div th:replace="layout/header"/>
    <!-- END: Header -->
    <!-- begin::Body -->
    <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">
        <!-- BEGIN: Left Aside -->
        <div th:replace="layout/sidebar"/>
        <!-- END: Left Aside -->
        <div class="m-grid__item m-grid__item--fluid m-wrapper">
            <div class="m-content">
                <div class="m-portlet m-portlet--full-height">

                        <div class="m-portlet__head">
                            <div class="m-portlet__head-caption">
                                <div class="m-portlet__head-title">
                                    <h3 class="m-portlet__head-text"></h3>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet__body">
                            <div class="m-scrollable" data-scrollbar-shown="true" data-axis="y" data-height="200">
                                <!--*********************************************************************************-->
                                <form th:action="@{/task/add}" id="document_form" class="m-form m-form--fit m-form--label-align-right" th:object="${taskObject}" method="POST">
                                    <div class="container">

                                        <div class="row">
                                            <div class="col-12">
                                                <input type="hidden" th:field="*{table}">
                                                <select class="s2s form-control m-input" id="entity" style="width: 100%">
                                                    <option th:each="r :${objectTypes}"
                                                            th:value="${r.className}"
                                                            th:text="${r.object}"> Object </option>
                                                </select>
                                            </div>
                                        </div>
                                        <hr>
                                        <div data-repeater-list="properties">
                                            <div data-repeater-item class="row">
                                                <div class="col-6">
                                                    <input type="text" class="form-control m-input" name=".property">
                                                </div>
                                                <div class="col-3">
                                                    <select class="s2s form-control m-input" name=".operator" data-minimum-results-for-search="-1">
                                                        <option th:each="o : ${operators}"
                                                                th:value="${o.getKey()}"
                                                                th:text="${o.getValue()}"> Operator </option>
                                                    </select>
                                                </div>
                                                <div class="col-2">
                                                    <input type="text" name=".value" class="form-control m-input"/>
                                                </div>
                                                <div class="col-1">
                                                    <button data-repeater-delete type="button" class="btn btn-danger">Delete</button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <button data-repeater-create type="button" class="btn btn-primary" id="add-button">Add</button>
                                </form>
                                <!--*********************************************************************************-->
                            </div>
                        </div>
                        <div class="m-portlet__foot">
                            <button type="submit" class="btn green" form="document_form">Save</button>
                            <button type="button" class="btn btn-primary float-none" onclick="window.history.back()"> Отмена </button>
                        </div>

                </div>
            </div>
        </div>
    </div>
    <!-- END CONTENT BODY -->
    <!-- begin::Footer -->
    <div th:replace="layout/footer"/>
    <!-- end::Footer -->
</div>
<div th:replace="fragments/footer :: footer-js"/>

<script th:src="@{/assets/global/plugins/jquery-repeater/jquery.repeater.js}" type="text/javascript"></script>
<script type="text/javascript" th:inline="javascript">

    $(document).ready(function() {

        $('#document_form').repeater({
            initEmpty: true,
            isFirstItemUndeletable: true
        });
        $('.s2s ').select2();
        $("#add-button").click(function(){
            setTimeout(function(){
                $(".s2s").select2();
            }, 100);
        });
        $('.item').hide();
        $("#" + $("#entity").val()).show();
        $("#entity").change(function (){
            $('#table').val($('#entity option:selected').text());
        });

        var x = 0;
        var wrapper = $(".prop");
        $(document).on('click', '.add-btn', function(){
            x++;
            $(wrapper).append(
                  '<div class="row" id="id_' + x + '">'
                + '<div class="col-12"></div>\n'
                + '<div class="col-5"><input type="text" class="form-control m-input" name="properties[' + x + '].property"/></div>\n'
                + '<select class="s2s form-control m-input" data-minimum-results-for-search="-1" th:field="*{properties[0].operator}">\n'
                + '<option th:each="o : ${operators} th:value="${o.getKey()}" th:text="${o.getValue()}"> Operator </option>\n'
                + '</select>'
                + '<div class="col-3"><input type="text" class="form-control m-input" name="properties[' + x + '].operator"/></div>\n'
                + '<div class="col-2"><input type="text" class="form-control m-input" name="properties[' + x + '].value"/></div>\n'
                + '<div class="col-1"><button type="button" class="add-btn btn btn-primary float-right"> ADD </button></div>'
                + '<div class="col-1"><button type="button" class="remove-btn btn btn-danger float-right"> REMOVE </button></div>'
                + '</div>');
        });
        $(document).on('click', '.remove-btn', function(e){
            e.preventDefault();
            $(this).parent('div').parent('div').remove();
            x--;
        });

        /*
        $('#' + $(this).val()).find( "select" ).val('').trigger('change');
        $('.item').hide();
        $('#' + $(this).val()).show();
        $('#table').val($(this).val());
        */

    });

    function setProp(e)
    {
        $("#prop").val($(e).val)
    }

</script>
<!--begin::Page Resources -->
</body>
</html>
