<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<!-- begin::Head -->
<head>
    <title th:text="#{label.identityDocType.page.title}">Loan view</title>

    <div th:replace="fragments/header :: header-css"/>
</head>
<!-- end::Head -->
<!-- end::Body -->
<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default m-aside-left--minimize m-brand--minimize"  >
<!-- begin:: Page -->
<div class="m-grid m-grid--hor m-grid--root m-page">
    <!-- BEGIN: Header -->
    <div th:replace="layout/header"/>
    <!-- END: Header -->

    <!-- begin::Body -->
    <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">
        <!-- BEGIN: Left Aside -->
        <div th:replace="layout/sidebar"/>
        <!-- END: Left Aside -->
        <div class="m-grid__item m-grid__item--fluid m-wrapper">

            <div class="m-content">
                <!--Begin Portlet-->
                <div class="m-portlet m-portlet--mobile">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" th:text="${'Список документов : ' + title}"></h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <div class="m-input-icon m-input-icon--left">
                                        <input type="text" class="form-control m-input" th:placeholder="#{label.search}" id="generalSearch">
                                        <span class="m-input-icon__icon m-input-icon__icon--left">
                                            <span><i class="la la-search"></i></span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">

                        <th:block th:replace="doc/layout::__${type + 'Index'}__"/>

                        <!--table class="table table-bordered table-hover" id="ddt">
                            <thead class="thead-default">
                                <tr>
                                    <th width="30px">*</th>
                                    <th width="30px"></th>
                                    <th width="120px">Исх. № <br> Дата</th>
                                    <th th:utext="|#{label.document.documentSubType} <br> #{label.document.title}|">Относительно</th>
                                    <th th:text="#{label.document.generalStatus}">Состояние</th>
                                    <th th:text="#{label.document.executer}">Исполнитель</th>
                                    <th th:text="#{label.document.receiver}">Получатель</th>
                                    <th width="120px" th:utext="|#{label.document.pageIndex} <br> #{label.document.pageCount}|">Номер бланка</th>
                                </tr>
                            </thead>
                        </table-->

                    </div>
                    <div class="m-portlet__foot">

                        <span th:if="${type=='incoming'}" sec:authorize="hasAnyAuthority('PERM_ADD_INCOMEDOC')" th:each="dst : ${documentSubTypes}">
                            <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                        </span>
                        <span th:if="${type!='incoming'}" th:each="dst : ${documentSubTypes}">
                            <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                        </span>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- begin::Footer -->
    <div th:replace="layout/footer"/>
    <!-- end::Footer -->
</div>

<div th:replace="fragments/footer :: footer-js"/>

<script th:src="@{/assets/global/plugins/datatables/datatables.js}" type="text/javascript"></script>

<script type="text/javascript" th:inline="javascript">

    $(".openact").click(function(event) {

        event.preventDefault();

        $.ajax({
            url: $(this).attr('href'),
            success: function(response) {
                alert(response);
                location.reload();
            }
        });

        return false;
    });

    $(document).ready(function()
    {
        var dtOptions = {
            stateSave: false,
            info: true,
            language: {
                emptyTable: "<center>Нет данных</center>",
                lengthMenu: "_MENU_",
                zeroRecords: "",
                info: "Всего _TOTAL_ записей",
                search: "Search : ... ",
                paginate: {
                    first: '<i class="la la-angle-double-left"></i>',
                    previous: '<i class="la la-angle-left"></i>',
                    next: '<i class="la la-angle-right"></i>',
                    last: '<i class="la la-angle-double-right"></i>'
                }
            },
            dom: "<'row'<'col-sm-12 col-md-6'i><'col-sm-12 col-md-6'l>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"
            //dom: 'rtlip',
        };
        var table = $('#documentTable').DataTable(dtOptions);

        /*
        var t1 = $('#ddt').DataTable({
            orderCellsTop: true,
            fixedHeader: true,
            searching: false,
            paging: true,
            processing: false,
            ajax: '/doc/documents',
            serverSide: true,
            columns: [
                {
                    searchable: false,
                    orderable: false,
                    data: function (data, type, full, meta) {
                        return "...";
                    }
                },
                {
                    searchable: false,
                    orderable: true,
                    name: 'docIndex',
                    data: 'docIndex'
                },
                {
                    searchable: true,
                    orderable: false,
                    name: 'senderRegisteredNumber',
                    data: function (data, type, full, meta) {
                        return data.senderRegisteredNumber + "<hr>" + new Date(data.senderRegisteredDate).toLocaleDateString();

                    }
                },
                {
                    searchable: true,
                    orderable: false,
                    name: 'documentSubType.name',
                    data: function (data, type, full, meta) {
                        return "<b>" + data.documentSubType.name + "</b><br>" + data.title;

                    }
                },
                {
                    searchable: false,
                    orderable: true,
                    name: 'documentState',
                    data: function (data, type, full, meta) {
                        return data.documentState === "REGISTERED" || data.documentState === "DONE" ? "Зарегистрирован" : "";
                    }
                },
                {
                    searchable: true,
                    orderable: true,
                    name: 'owner.staff.name',
                    data: 'owner.staff.name'
                },
                {
                    searchable: true,
                    orderable: false,
                    name: 'receiverResponsible',
                    data: function (data, type, full, meta) {

                        var r = [];

                        if(data.receiverResponsible.responsibleType == 3)
                        {
                            data.receiverResponsible.organizations.forEach(function(element) {
                                r.push(element.name)
                            });
                        }

                        if(data.receiverResponsible.responsibleType == 3)
                        {
                            data.receiverResponsible.person.forEach(function(element) {
                                r.push(element.name)
                            });
                        }

                        return r;
                    }
                },
                {
                    searchable: true,
                    orderable: false,
                    name: 'indexNo',
                    data: function (data, type, full, meta) {
                        return data.indexNo + "<hr>" + data.pageCount;
                    }
                }
            ],
            language: {
                emptyTable: "<center>Нет данных</center>",
                info: "Всего _TOTAL_ записей",
                lengthMenu: "_MENU_",
                paginate: {
                    first: '<i class="la la-angle-double-left"></i>',
                    previous: '<i class="la la-angle-left"></i>',
                    next: '<i class="la la-angle-right"></i>',
                    last: '<i class="la la-angle-double-right"></i>'
                }
            },
            dom: '<t<i>pl>',
        });

        /*
        $('#ddt thead tr').clone(true).appendTo( '#ddt thead' );
        $('#ddt thead tr:eq(1) th').each( function (i) {

            $(this).html('<input type="text" class="form-control m-input m-input--solid">');
            $('input', this).on('keyup change', function (){

                if (this.value.length > 2 && table.column(i).search() !== this.value) {
                    table.column(i)
                        .search(this.value)
                        .draw();
                }
            });
        });
        */
        /*
        l - perpage
        r - processing
        t - table
        i - info
        p - paging
        f - filter
        */

        $('#generalSearch').keyup(function(){
            table.search($(this).val()).draw() ;
        });
    });

</script>

</body>
<!-- end::Body -->
</html>

