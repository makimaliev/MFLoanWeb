<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<title>MFLoan | Docflow</title>

	<div th:replace="fragments/header :: header-css"></div>

	<link th:href="@{/assets/global/plugins/datatables/keyTable.bootstrap.css}" rel="stylesheet" type="text/css" />
	<link th:href="@{/assets/global/plugins/datatables/datatables.min.css}" rel="stylesheet" type="text/css" />
	<link th:href="@{/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css}" rel="stylesheet" type="text/css" />

</head>
<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-closed">

<div th:replace="layout :: header-top"></div>

<div class="modal fade" id="modal_form" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header"><h3 class="modal-title" id="modal-title">Document Form</h3></div>
			<div class="modal-body form">

				<form action="#" id="form" class="form-horizontal">
					<input type="hidden" value="" name="id"/>
					<div class="form-body">

						<div class="form-group">
							<label class="control-label col-md-4">Title<span class="required"> * </span></label>
							<div class="col-md-6">
								<input name="title" placeholder="Title" class="form-control" type="text">
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-4">Description<span class="required"> * </span></label>
							<div class="col-md-6">
								<input name="description" placeholder="Description" class="form-control" type="text">
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-4">Document Type<span class="required"> * </span></label>
							<div class="col-md-6">
								<select class="form-control" name="documentType.id">
									<option value=""> *** Select Document Type *** </option>
									<option th:each="dt : ${documentType}"
											th:value="${dt.id}"
											th:text="${dt.name}">Document Type</option>
								</select>
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-md-4">Document SubType<span class="required"> * </span></label>
							<div class="col-md-6">
								<select class="form-control" name="documentSubType.id">
									<option value=""> *** Select Document Sub Type *** </option>
									<option th:each="dst : ${documentSubType}"
											th:value="${dst.id}"
											th:text="${dst.name}">Document SubType</option>
								</select>
							</div>
						</div>

					</div>
				</form>

			</div>
			<div class="modal-footer">
				<button type="button" id="btnSave" onclick="save()" class="btn btn-primary">Save</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
			</div>
		</div>
	</div>
</div>

<div class="page-container">
	<div th:replace="layout :: page-container-sidebar" />

	<div class="page-content-wrapper">
		<div class="page-content">

			<div class="row">
				<div class="col-md-12">

					<table class="table table-hover table-condensed table-striped table-bordered compact condensed" id="documentTable">
						<thead>
						<tr>
							<th>Id</th>
							<th>Title</th>
							<th>Description</th>
							<th>Document Type</th>
							<th>Document SubType</th>
							<th>View</th>
							<th>Edit</th>
							<th>Delete</th>
						</tr>
						</thead>

						<tbody></tbody>
					</table>

				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<button class="btn btn-success" onclick="add_document()"><i class="glyphicon glyphicon-plus"></i> Add Document </button>
				</div>
			</div>

		</div>
	</div>

</div>

<div th:replace="layout :: footer"></div>
<div th:replace="fragments/footer :: footer-js"></div>

<script th:src="@{/assets/global/plugins/datatables/datatables.js}" type="text/javascript"></script>
<script th:src="@{/assets/global/plugins/datatables/dataTables.keyTable.js}" type="text/javascript"></script>
<script type="text/javascript">

    var table;

    $(document).ready(function() {

        table = $("#documentTable").DataTable({
			"processing": true,
            "language": {"url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Russian.json"},
            "info":     false,
            "ajax": {
                "url" : "/MFLoanWeb/doc/all",
                "dataSrc": ""
            },
            "columns": [
                { "data": "id" },
                { "data": "title" },
                { "data": "description" },
                { "data": "documentType.name" },
                { "data": "documentSubType.name" },
                { "data": "id" },
                { "data": "id" },
                { "data": "id" }
            ],
            keys: { focus: ':eq(0)' },
            "columnDefs": [
                {
                    "targets": [5],
                    "render": function (data, type, row) {
                        return "<a href='/MFLoanWeb/doc/view/" + data + "' role='button' class='btn btn-xs green-stripe'> View </a>"
                    }
                },
                {
                    "targets": [6],
                    "orderable": false,
                    "render": function (data, type, row) {
                        return '<a data-toggle="modal" data-target="#modal_form" href="#" onclick="edit_document(' + data + ');" role="button" class="btn btn-xs blue-stripe"> Edit </a>'
                    }
                },
                {
                    "targets": [7],
                    "orderable": false,
                    "render": function (data, type, row) {
                        return '<a href="#" onclick="delete_document(' + data + ');" role="button" class="btn btn-xs red-stripe"> Delete </a>'
                    }
                },
            ],
        });
    });
    function add_document() {
        $(".form-group").removeClass("has-error");
        $("#form")[0].reset();
        $('[name="id"]').val(0);

        formState(false, "New Document");

        $('[name="tabs"]').hide();
        $("#btnSave").text('Create');
    }
    function edit_document(id) {
        $("#form")[0].reset();
        $(".form-group").removeClass('has-error');
        $("#btnSave").text('Update');
        $.ajax({
            url : "/MFLoanWeb/doc/" + id,
            type: "GET",
            dataType: "JSON",
            success: function(data) {
                formState(false, "Edit Document");
                loadData(data);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Error get data from ajax");
            }
        });
    }
    function delete_document(id) {
        if(confirm('Are you sure delete this data?'))
        {
            $.ajax({
                url : "/MFLoanWeb/doc/remove/" + id,
                type: "POST",
                dataType: "text",
                success: function(data)
                {
                    reload_table();
                    alert("Document succesfully delted!");
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert('Error deleting Document!');
                }
            });
        }
    }
    function save() {
        $("#btnSave").text('Saving...');
        $("#btnSave").attr('disabled',true);
        $.ajax({
            url : "/MFLoanWeb/doc/add",
            type: "POST",
            data: $('#form').serialize(),
            dataType: "text",
            success: function(data)
            {
                reload_table();
            },
            error: function (jqXHR, textStatus, errorThrown)
            {
                alert("Erooooooooor");
            }
        });
        $("#modal_form").modal('hide');
        $('#btnSave').text('Save');
        $('#btnSave').attr('disabled',false);
    }
    function reload_table() {
        table.ajax.reload(null,false);
    }
    function loadData(item) {

        $('[name="id"]').val(item.id);
        $('[name="title"]').val(item.title);
        $('[name="description"]').val(item.description);
        $('[name="documentType.id"]').val(item.documentType.id);
        $('[name="documentSubType.id"]').val(item.documentSubType.id);
    }
    function formState(state, mtitle) {

        $('[name="tabs"]').show();

        $('[name="title"]').attr('disabled', state);
        $('[name="description"]').attr('disabled', state);
        $('[name="documentType.id"]').attr('disabled', state);
        $('[name="documentSubType.id"]').attr('disabled', state);

        if(state) {
            $('#btnSave').hide();
        }
        else
		{
            $('#btnSave').show();
		}
        $(".modal-title").text(mtitle);
        $("#modal_form").modal('show');
    }

</script>

</body>
</html>