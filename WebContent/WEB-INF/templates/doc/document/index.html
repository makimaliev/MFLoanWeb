<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<!-- begin::Head -->
<head>
    <div th:replace="fragments/header :: header-css"/>
</head>
<!-- end::Head -->

<!-- end::Body -->
<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default m-aside-left--minimize m-brand--minimize"  >
<!-- begin:: Page -->

<div class="m-grid m-grid--hor m-grid--root m-page">
    <!-- BEGIN: Header -->
    <div th:replace="layout/header"/>
    <!-- END: Header -->
    <!-- begin::Body -->
    <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">
        <!-- BEGIN: Left Aside -->
        <div th:replace="layout/sidebar"/>
        <!-- END: Left Aside -->
        <div class="m-grid__item m-grid__item--fluid m-wrapper">
            <div class="m-content">
                <div class="m-portlet m-portlet--mobile">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" th:text="${'Список документов : ' + title}"></h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <div class="m-input-icon m-input-icon--left">
                                        <input type="text" class="form-control m-input" th:placeholder="#{label.search}" id="generalSearch">
                                        <span class="m-input-icon__icon m-input-icon__icon--left">
                                            <span><i class="la la-search"></i></span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">

                        <th:block th:replace="doc/layout::__${type + 'Index'}__"/>
                        <!--table class="table table-bordered table-hover" id="ddt">
                            <thead class="thead-default">
                                <tr>
                                    <th width="30px">*</th>
                                    <th width="30px"></th>
                                    <th width="120px">Исх. № <br> Дата</th>
                                    <th th:utext="|#{label.document.documentSubType} <br> #{label.document.title}|">Относительно</th>
                                    <th th:text="#{label.document.generalStatus}">Состояние</th>
                                    <th th:text="#{label.document.executer}">Исполнитель</th>
                                    <th th:text="#{label.document.receiver}">Получатель</th>
                                    <th width="120px" th:utext="|#{label.document.pageIndex} <br> #{label.document.pageCount}|">Номер бланка</th>
                                </tr>
                            </thead>
                        </table-->

                    </div>
                    <div class="m-portlet__foot">

                        <span th:if="${type=='incoming'}" sec:authorize="hasAnyAuthority('PERM_ADD_INCOMEDOC')" th:each="dst : ${documentSubTypes}">
                            <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                        </span>
                        <span th:if="${type!='incoming'}" th:each="dst : ${documentSubTypes}">
                            <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                        </span>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END CONTENT BODY -->
    <!-- begin::Footer -->
    <div th:replace="layout/footer"/>
    <!-- end::Footer -->
</div>
<div class="m-scroll-top m-scroll-top--skin-top" data-toggle="m-scroll-top" data-scroll-offset="500" data-scroll-speed="300">
    <i class="la la-arrow-up"></i>
</div>
<div th:replace="fragments/footer :: footer-js"/>

<script th:src="@{/assets/global/plugins/datatables/datatables.js}" type="text/javascript"></script>

<script type="text/javascript" th:inline="javascript">

    $(document).ready(function()
    {
        var dtOptions = {
            stateSave: false,
            info: true,
            language: {
                emptyTable: "<center>Нет данных</center>",
                lengthMenu: "_MENU_",
                zeroRecords: "",
                info: "_END_ из _TOTAL_ записей",
                search: "Search : ... ",
                paginate: {
                    first: '<i class="la la-angle-double-left"></i>',
                    previous: '<i class="la la-angle-left"></i>',
                    next: '<i class="la la-angle-right"></i>',
                    last: '<i class="la la-angle-double-right"></i>'
                }
            },
            sDom: 'rtlip',
        };
        var table = $('#documentTable').DataTable(dtOptions);

        $(".openact").click(function(event) {

            //var t1 = table.cell($(this).closest("tr"), 2);
            //var t2 = table.cell($(this).closest("tr"), 3);

            event.preventDefault();

            $.ajax({
                url: $(this).attr('href'),
                success: function(response) {
                    alert(response);
                    location.reload();
                }
            });

            //return false;
        });

        $(".tim").click(function(event) {
            event.preventDefault();
            table.cell($(this).closest("tr"), 3).data("Nurlan");
        });

        /*
        var t1 = $('#ddt').DataTable({
            info: false,
            paging: true,
            processing: true,
            ajax: '/doc/documents',
            serverSide: true,
            columns: [
                {
                    searchable: false,
                    orderable: false,
                    data: function (data, type, full, meta) {
                        return "...";
                    }
                },
                {
                    searchable: false,
                    orderable: true,
                    name: 'docIndex',
                    data: 'docIndex'
                },
                {
                    searchable: false,
                    orderable: false,
                    name: 'senderRegisteredNumber',
                    data: function (data, type, full, meta) {
                        return data.senderRegisteredNumber + "<hr>" + new Date(data.senderRegisteredDate).toLocaleDateString();

                    }
                },
                {
                    searchable: false,
                    orderable: false,
                    name: 'documentSubType.name',
                    data: function (data, type, full, meta) {
                        return "<b>" + data.documentSubType.name + "</b><br>" + data.title;

                    }
                },
                {
                    searchable: false,
                    orderable: false,
                    name: 'documentState',
                    data: function (data, type, full, meta) {
                        return data.documentState === "REGISTERED" || data.documentState === "DONE" ? "Зарегистрирован" : "";
                    }
                },
                {
                    searchable: false,
                    orderable: false,
                    name: 'owner.staff.name',
                    data: 'owner.staff.name'
                },
                {
                    searchable: false,
                    orderable: false,
                    name: 'receiverResponsible',
                    data: function (data, type, full, meta) {

                        var r = [];

                        if(data.receiverResponsible.responsibleType == 3)
                        {
                            data.receiverResponsible.organizations.forEach(function(element) {
                                r.push(element.name)
                            });
                        }

                        if(data.receiverResponsible.responsibleType == 3)
                        {
                            data.receiverResponsible.person.forEach(function(element) {
                                r.push(element.name)
                            });
                        }

                        return r;
                    }
                },
                {
                    searchable: false,
                    orderable: false,
                    name: 'indexNo',
                    data: function (data, type, full, meta) {
                        return data.indexNo + "<hr>" + data.pageCount;
                    }
                }
            ]
        });
        */

        /*
        $('#documentTable tbody').on( 'click', 'td', function () {
            alert( table.cell( this ).data() );
        } );
        */

        $('#generalSearch').keyup(function(){
            table.search($(this).val()).draw() ;
        });
    });

</script>

</body>
</html>