<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<title>MFLoan | Docflow</title>

	<div th:replace="fragments/header :: header-css"></div>

	<link th:href="@{/assets/global/plugins/datatables/keyTable.bootstrap.css}" rel="stylesheet" type="text/css" />
	<link th:href="@{/assets/global/plugins/datatables/datatables.min.css}" rel="stylesheet" type="text/css" />
	<link th:href="@{/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css}" rel="stylesheet" type="text/css" />

</head>
<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-closed">

<div th:replace="doc/document/content :: document"></div>

<div th:replace="layout :: header-top"></div>

<div class="page-container">

	<div th:replace="layout :: page-container-sidebar" />

	<div class="page-content-wrapper">
		<div class="page-content">
			<div class="row">
				<div class="col-md-12">
					<table class="table table-hover table-condensed table-striped table-bordered compact condensed" id="documentTable">
						<thead>
						<tr>
							<th>Id</th>
							<th>Title</th>
							<th>Description</th>
							<th>Document SubType</th>
							<th>View</th>
							<th>Edit</th>
							<th>Delete</th>
						</tr>
						</thead>

						<tbody></tbody>
					</table>

				</div>
			</div>

			<span class="row">
				<div class="col-md-12">
					<button class="btn btn-primary"> Filter </button>
				</div>
				<div class="col-md-12" th:if="${type} == 'internal'">
					<span th:each="dst : ${documentSubType}">
						<a href="#" class="btn btn-success" th:onclick="'create_document(\'' + ${dst.name} +'\',\''+ ${dst.documentType.id} +'\',\''+ ${dst.id} + '\');'" th:text="${dst.name}"> New Document </a>
					</span>
				</div>
			</span>
		</div>
	</div>

</div>

<div th:replace="layout :: footer"></div>
<div th:replace="fragments/footer :: footer-js"></div>

<script th:src="@{/assets/global/plugins/datatables/datatables.js}" type="text/javascript"></script>
<script th:src="@{/assets/global/plugins/datatables/dataTables.keyTable.js}" type="text/javascript"></script>
<script th:inline="javascript">

    var table;
    var documentType;

    $(document).ready(function() {

        table = $("#documentTable").DataTable({
			"processing": true,
            "language": {"url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Russian.json"},
            "info":     false,
            "ajax": {
                "url" : "/MFLoanWeb/doc/" + [[${type}]],
                "dataSrc": ""
            },
            "columns": [
                { "data": "id" },
                { "data": "title" },
                { "data": "description" },
                { "data": "documentSubType.name" },
                { "data": "id" },
                { "data": "id" },
                { "data": "id" }
            ],
            keys: { focus: ':eq(0)' },
            "columnDefs": [
                {
                    "targets": [4],
                    "render": function (data, type, row) {
                        return "<a href='/MFLoanWeb/doc/view/" + data + "' role='button' class='btn btn-xs green-stripe'> View </a>"
                    }
                },
                {
                    "targets": [5],
                    "orderable": false,
                    "render": function (data, type, row) {
                        return '<a data-toggle="modal" data-target="#modal_form" href="#" onclick="edit_document(' + data + ');" role="button" class="btn btn-xs blue-stripe"> Edit </a>'
                    }
                },
                {
                    "targets": [6],
                    "orderable": false,
                    "render": function (data, type, row) {
                        return '<a href="#" onclick="delete_document(' + data + ');" role="button" class="btn btn-xs red-stripe"> Delete </a>'
                    }
                },
            ],
        });
    });
    function create_document(title, doctype, docsubtype) {
        $(".form-group").removeClass("has-error");
        $("#form")[0].reset();
        $('[name="id"]').val(0);

        $('[name="documentType.id"]').val([[${documentTypeId}]]);
        $('[name="documentSubType.id"]').val(docsubtype);

        formState(false, title);

        $('[name="tabs"]').hide();
        $("#btnSave").text('Create');
    }
    function edit_document(id) {
        $("#form")[0].reset();
        $(".form-group").removeClass('has-error');
        $("#btnSave").text('Update');
        $.ajax({
            url : "/MFLoanWeb/doc/" + id,
            type: "GET",
            dataType: "JSON",
            success: function(data) {
                formState(false, "Edit Document");
                loadData(data);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("Error get data from ajax");
            }
        });
    }
    function delete_document(id) {
        if(confirm('Are you sure delete this data?'))
        {
            $.ajax({
                url : "/MFLoanWeb/doc/remove/" + id,
                type: "POST",
                dataType: "text",
                success: function(data)
                {
                    reload_table();
                    alert("Document succesfully delted!");
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert('Error deleting Document!');
                }
            });
        }
    }
    function save_document() {
        $("#btnSave").text('Saving...');
        $("#btnSave").attr('disabled',true);
        $.ajax({
            url : "/MFLoanWeb/doc/add",
            type: "POST",
            data: $('#form').serialize(),
            dataType: "text",
            success: function(data)
            {
                reload_table();
            },
            error: function (jqXHR, textStatus, errorThrown)
            {
                alert("Erooooooooor");
            }
        });
        $("#documentModal").modal('hide');
        $('#btnSave').text('Save');
        $('#btnSave').attr('disabled',false);
    }
    function reload_table() {
        table.ajax.reload(null,false);
    }
    function loadData(item) {

        $('[name="id"]').val(item.id);
        $('[name="title"]').val(item.title);
        $('[name="description"]').val(item.description);
        $('[name="documentType.id"]').val(item.documentType.id);
        $('[name="documentSubType.id"]').val(item.documentSubType.id);
    }
    function formState(state, mtitle) {

        $('[name="tabs"]').show();

        $('[name="title"]').attr('disabled', state);
        $('[name="description"]').attr('disabled', state);
        $('[name="documentType.id"]').attr('disabled', state);
        $('[name="documentSubType.id"]').attr('disabled', state);

        if(state) {
            $('#btnSave').hide();
        }
        else
		{
            $('#btnSave').show();
		}
        $(".modal-title").text(mtitle);
        $("#documentModal").modal('show');
    }

    /*
    $( "#rt" ).change(
        function() {
            var html = '<option value=""> *** Select Responsible *** </option>';
            var selection = $(this).val();
            var data;

            if (selection == 1)
			{
                data = [[${staff}]];
			}
            else if (selection == 2)
			{
                data = [[${department}]];
			}
            else if (selection == 3)
            {
                data = [[${organization}]];
            }
            else if (selection == 4)
            {
                data = [[${person}]];
            }

            var len = data.length;
            for ( var i = 0; i < len; i++) {
                html += '<option value="' + data[i].id + '">' + data[i].name + '</option>';
            }
            html += '</option>';
            $('#responsible').html(html);
    	}
    );
	*/
</script>

</body>
</html>