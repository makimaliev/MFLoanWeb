<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!-- begin::Head -->
<head>
    <div th:replace="fragments/header :: header-css"/>
</head>
<!-- end::Head -->

<!-- end::Body -->
<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default m-aside-left--minimize m-brand--minimize"  >
<!-- begin:: Page -->

<div class="m-grid m-grid--hor m-grid--root m-page">
    <!-- BEGIN: Header -->
    <div th:replace="layout/header"/>
    <!-- END: Header -->
    <!-- begin::Body -->
    <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">
        <!-- BEGIN: Left Aside -->
        <div th:replace="layout/sidebar"/>
        <!-- END: Left Aside -->
        <div class="m-grid__item m-grid__item--fluid m-wrapper">
            <div class="m-content">
                <div class="m-portlet m-portlet--mobile">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" th:text="${'Список документов : ' + title}"></h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <div class="m-input-icon m-input-icon--left">
                                        <input type="text" class="form-control m-input" th:placeholder="#{label.search}" id="generalSearch">
                                        <span class="m-input-icon__icon m-input-icon__icon--left">
                                            <span><i class="la la-search"></i></span>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class="table table-bordered" id="documentTable">
                            <thead class="thead-default">
                            <tr>
                                <th width="50px"></th>
                                <th>№</th>
                                <th th:text="#{label.document.title}">Заголовок</th>
                                <th th:text="#{label.document.documentSubType}">Тип документа</th>
                                <th th:text="#{label.document.generalStatus}">Состояние</th>
                                <th th:text="#{label.document.sender}">Отправитель</th>
                                <th th:text="#{label.document.receiver}">Получатель</th>
                                <th th:text="#{label.document.dueDate}" width="130px">Срок</th>
                                <th width="30px"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="document : ${documents}">
                                <td class="text-danger text-center"><span th:if="${document.documentDueDate}">K</span></td>
                                <td th:text="${document.id}"></td>
                                <td th:text="${document.title}"></td>
                                <td th:text="${document.documentSubType.name}"></td>
                                <td th:text="${document.documentState.text()}"></td>
                                <td th:text="${responsible[__${document.getSenderResponsible()?.responsibleType}__ ?: 0]}">None</td>
                                <td th:text="${responsible[__${document.getReceiverResponsible()?.responsibleType}__ ?: 0]}">None</td>
                                <td th:text="${document.documentDueDate} != null ? ${#dates.format(document.documentDueDate, 'dd-MM-yyyy')} : 'Не установлен'">None</td>
                                <td class="table-actions text-right">
                                        <span>
                                            <div class="dropdown">
                                                <a href="#" class="btn m-btn m-btn--hover-metal m-btn--icon m-btn--icon-only m-btn--pill btn-dropdown" data-toggle="dropdown"><i class="la la-ellipsis-h"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">

                                                    <a class="dropdown-item" th:href="@{/doc/view/__${document.id}__}" th:if="${tasks.?[objectId == __${document.id}__].isEmpty()}" id="linkView">
                                                        <span th:text="#{label.view}"></span>
                                                    </a>

                                                    <a class="dropdown-item" th:href="@{/doc/edit/__${document.id}__}" th:if="${not tasks.?[objectId == __${document.id}__].isEmpty()}" id="linkEdit">
                                                        <span th:text="#{label.open}"></span>
                                                    </a>

                                                    <!--a class="dropdown-item" th:href="@{/doc/edit/__${document.id}__}" th:if="${document.documentState.toString() == 'DRAFT' and  document.owner == __${cu}__}" id="linkEditCu">
                                                        <span th:text="#{label.open}"></span>
                                                    </a>
                                                    <a class="dropdown-item" th:href="@{/doc/delete/__${document.id}__}" th:if="${document.documentState.ordinal() < 2}">
                                                        <span th:text="#{label.delete}"></span>
                                                    </a-->
                                                </div>
                                            </div>
                                        </span>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                    </div>
                    <div class="m-portlet__foot">
                        <span th:each="dst : ${documentSubTypes}">
                            <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END CONTENT BODY -->
    <!-- begin::Footer -->
    <div th:replace="layout/footer"/>
    <!-- end::Footer -->
</div>
<div class="m-scroll-top m-scroll-top--skin-top" data-toggle="m-scroll-top" data-scroll-offset="500" data-scroll-speed="300">
    <i class="la la-arrow-up"></i>
</div>
<div th:replace="fragments/footer :: footer-js"/>

<script th:src="@{/assets/global/plugins/datatables/datatables.js}" type="text/javascript"></script>

<script type="text/javascript" th:inline="javascript">

    var tasks = [[${tasks}]];
    var dtOptions = {
        stateSave: true,
        info: '',
        language: {
            emptyTable: "<center>Нет данных</center>",
            lengthMenu: "_MENU_",
            zeroRecords: "",
            info: "",
            search: "Search : ... ",
            paginate: {
                first: '<i class="la la-angle-double-left"></i>',
                previous: '<i class="la la-angle-left"></i>',
                next: '<i class="la la-angle-right"></i>',
                last: '<i class="la la-angle-double-right"></i>'
            }
        },
        sDom: 'rtlip',
    };
    var table = $('#documentTable').DataTable(dtOptions);

    $('#generalSearch').keyup(function(){
        table.search($(this).val()).draw() ;
    });

    $(document).ready(function() {

        for (var i = 0; i < tasks.length; i++) {
            $.notify({
                title: 'Задача №: ' + (i + 1),
                message: '<a href="/doc/edit/' + tasks[i].objectId + '" role="button" class="btn btn-link text-light" style="text-decoration: none;">' + tasks[i].description + '</a>'
            }, {
                delay: 3000,
                type: "info",
                template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
                '<button type="button" aria-hidden="true" class="close" data-notify="dismiss"></button>' +
                '<span data-notify="icon"></span> ' +
                '<span data-notify="title">{1}</span> ' +
                '<span data-notify="message">{2}</span>' +
                '<div class="progress" data-notify="progressbar">' +
                '<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>' +
                '</div>' +
                '<a href="{3}" target="{4}" data-notify="url"></a>' +
                '</div>'
            });
        }

        //var responsible = ["", "Сотрудник", "Отдел", "Организация", "ФИЗ Лицо"];
        //var docType = [[${type}]];
        /*
        var options = {

            data: {
                type: 'remote',
                source: {
                    read: {
                        url: '/data/documents?type=' + docType,
                        method: 'GET'
                    }
                },
                pageSize: 10
            },
            layout: {
                theme: "default",
                class: "",
                scroll: !1,
                footer: !1
            },
            sortable: !0,
            pagination: !0,
            search: {
                input: $("#generalSearch")
            },
            columns: [{
                field: "id",
                title: "#",
                sortable: 'asc',
                width: 40,

            }, {
                field: "title",
                title: "Заголовок",
                sortable: true,
                filterable: true
            }, {
                field: "documentSubType",
                title: "Тип документа",
                sortable: true,
                filterable: true,
                template: function (row) {
                    return row.documentSubType.name;
                }
            }, {
                field: "generalStatus.name",
                title: "Состояние",
                sortable: true,
                filterable: true,
                template: function (row) {
                    return row.generalStatus.name;
                }
            }, {
                field: "senderResponsible.responsibleType",
                title: "Отправитель",
                sortable: true,
                filterable: true,
                template: function (row) {
                    return responsible[row.senderResponsible.responsibleType];
                }
            }, {
                field: "receiverResponsible.responsibleType",
                title: "Получатель",
                sortable: true,
                filterable: true,
                template: function (row) {
                    return responsible[row.receiverResponsible.responsibleType];
                }
            }, {
                field: "senderDueDate",
                title: "Срок",
                width: 70,
                template: function (row) {
                    return new Date(row.senderDueDate).toLocaleDateString();
                }
            }, {
                field: "",
                title: "",
                width: 40,
                overflow: 'visible',
                template: function (row) {
                    return '<div class="dropup"><a href="#" class="btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" data-toggle="dropdown"><i class="la la-ellipsis-h"></i></a>' +
                        '<div class="dropdown-menu dropdown-menu-right">' +
                        '<a class="dropdown-item" href="/doc/view/' + row.id + '"><span>Просмотр</span></a>' +
                        '<a class="dropdown-item" href="/doc/delete/' + row.id + '"><span>Удалить</span></a>' +
                        '</div>' +
                        '</div>';
                }
            }],
            toolbar: {
                layout: ['pagination', 'info'],
                placement: ['bottom'],
                items: {
                    pagination: {
                        type: 'default',
                        navigation: {
                            prev: true,
                            next: true,
                            first: true,
                            last: true
                        },
                        pageSizeSelect: [10, 20, 30, 50, 100]
                    },
                    info: true
                }
            },
            translate: {
                records: {
                    processing: 'Идет загрузка ...',
                    noRecords: 'Нет данных'
                },
                toolbar: {
                    pagination: {
                        items: {
                            info: ''
                        }
                    }
                }
            }
        };
        */
        //var mTable = $('#m_datatable').mDatatable(options);
    });

</script>

</body>
</html>