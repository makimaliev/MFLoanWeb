<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<!-- begin::Head -->
<head>
    <title th:text="#{label.identityDocType.page.title}">Loan view</title>

    <div th:replace="fragments/header :: header-css"/>

    <style type="text/css" th:inline="text">
        .nopm {
            padding: 0;
            margin: 0;
        }
        .active-document {
            background: #d9d9d9;
        }
        td.details-control {
            background: url([[@{/doc/document/details_open.png}]]) no-repeat center center;
            cursor: pointer;
        }
        tr.details td.details-control {
            background: url([[@{/doc/document/details_close.png}]]) no-repeat center center;
        }
    </style>

</head>
<!-- end::Head -->
<!-- end::Body -->
<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default m-aside-left--minimize m-brand--minimize"  >
<!-- begin:: Page -->
<div class="m-grid m-grid--hor m-grid--root m-page">
    <!-- BEGIN: Header -->
    <div th:replace="layout/header"/>
    <!-- END: Header -->

    <!-- begin::Body -->
    <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">
        <!-- BEGIN: Left Aside -->
        <div th:replace="layout/sidebar"/>
        <!-- END: Left Aside -->
        <div class="m-grid__item m-grid__item--fluid m-wrapper">

            <div class="m-content">
                <!--Begin Portlet-->
                <div class="m-portlet m-portlet--mobile">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" th:text="${'Список документов : ' + title}"></h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <div class="row">
                            <div class="col-md-2">
                                <div class="m-form__group m-form__group--inline">
                                    <div class="m-form__label">
                                        <label>
                                            Название:
                                        </label>
                                    </div>
                                    <div class="m-form__control">
                                        <div class="m-input-icon m-input-icon--left mb-2">
                                            <input type="text" class="form-control m-input m-input--solid" th:placeholder="#{label.search}" id="title">
                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                                <span>
                                    <i class="la la-search"></i>
                                </span>
                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="m-form__group m-form__group--inline">
                                    <div class="m-form__label">
                                        <label>
                                            Отправитель:
                                        </label>
                                    </div>
                                    <div class="m-form__control">
                                        <div class="m-input-icon m-input-icon--left mb-2">
                                            <input type="text" class="form-control m-input m-input--solid" th:placeholder="#{label.search}" id="sender">
                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                            <span>
                                <i class="la la-search"></i>
                            </span>
                        </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="m-form__group m-form__group--inline">
                                    <div class="m-form__label">
                                        <label>
                                            Получатель:
                                        </label>
                                    </div>
                                    <div class="m-form__control">
                                        <div class="m-input-icon m-input-icon--left mb-2">
                                            <input type="text" class="form-control m-input m-input--solid" th:placeholder="#{label.search}" id="receiver">
                                            <span class="m-input-icon__icon m-input-icon__icon--left">
                                <span>
                                    <i class="la la-search"></i>
                                </span>
                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="m-form__group m-form__group--inline">
                                    <div class="m-form__label">
                                        <label>
                                            Виды:
                                        </label>
                                    </div>
                                    <div class="m-form__control">
                                        <select class="form-control m-bootstrap-select m-bootstrap-select--solid" id="sub_type">
                                            <option value="">
                                                Все
                                            </option>
                                            <option th:each="sub : ${documentSubTypes}" th:value="${sub.id}" th:text="${sub.name}"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="input-group date m_datetimepicker mb-2" id="from_date">
                                    <input  class="form-control m-input" th:placeholder="#{label.fromDate}" name="date" />
                                    <span class="input-group-addon">
                                                    <i class="la la-calendar glyphicon-th"></i>
                                                </span>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="input-group date m_datetimepicker" id="to_date">
                                    <input  class="form-control m-input" th:placeholder="#{label.toDate}" name="date" />
                                    <span class="input-group-addon">
                                                    <i class="la la-calendar glyphicon-th"></i>
                                                </span>
                                </div>
                            </div>
                        </div>

                        <div class="m-form m-form--label-align-right m--margin-top-20 m--margin-bottom-30" sec:authorize="hasAnyAuthority('PERM_ADD_INCOMEDOC')">
                            <div class="row align-items-center">
                                <div class="col-12 m--align-right">

                                    <span th:if="${type=='incoming'}" th:each="dst : ${documentSubTypes}">
                                        <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                                    </span>

                                    <div class="m-separator m-separator--dashed d-xl-none"></div>
                                </div>
                            </div>
                        </div>

                        <hr>
                        <div  class="m_datatable"></div>

                        <!--<th:block th:replace="doc/layout::__${type + 'Index'}__"/>-->

                        <!--table class="table table-bordered table-hover" id="incoming">
                            <thead class="thead-default">
                                <tr>
                                    <th width="30px"></th>
                                    <th width="30px"></th>
                                    <th width="120px">К</th>
                                    <th width="80px">Вхд. №</th>
                                    <th width="120px">Вхд. Дата</th>
                                    <th width="120px">Исх. № и Дата</th>
                                    <th th:text="#{label.document.sender}">Отправитель</th>
                                    <th th:text="#{label.document.title}">Относительно</th>
                                    <th width="330px" th:text="#{label.document.receiver}">Исполнитель</th>
                                    <th width="150px" th:text="#{label.document.generalStatus}">Состояние</th>
                                </tr>
                            </thead>
                        </table-->
                        <hr>

                    </div>
                    <div class="m-portlet__foot">
                        <span th:if="${type!='incoming'}" th:each="dst : ${documentSubTypes}">
                            <a th:href="@{/doc/new/__${dst.internalName}__}" class="btn btn-success" th:text="${dst.name}"> New Document </a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- begin::Footer -->
    <div th:replace="layout/footer"/>
    <!-- end::Footer -->
</div>

<div th:replace="fragments/footer :: footer-js"/>

<script th:src="@{/assets/global/plugins/datatables/datatables.js}" type="text/javascript"></script>

<script type="text/javascript" th:inline="javascript">

    // $(".openact").click(function(event) {
    //
    //     event.preventDefault();
    //
    //     $.ajax({
    //         url: $(this).attr('href'),
    //         success: function(response) {
    //             alert(response);
    //             location.reload();
    //         }
    //     });
    //
    //     return false;
    // });
    //
    // function format ( d ) {
    //     return  'Content : ' + d.title + '<br>';
    // }
    //
    // $(document).ready(function()
    // {
    //     var dtOptions = {
    //         stateSave: true,
    //         info: true,
    //         language: {
    //             lengthMenu: 'Показать <select>'+
    //                     '<option value="10">10</option>'+
    //                     '<option value="25">25</option>'+
    //                     '<option value="50">50</option>'+
    //                     '<option value="100">100</option>'+
    //                     '<option value="-1">Все</option>'+
    //                     '</select>',
    //             emptyTable: "<center>Нет данных</center>",
    //             search: "&nbsp;Поиск : &nbsp; ",
    //             zeroRecords: "",
    //             info: "Всего _TOTAL_ записей",
    //             paginate: {
    //                 first: '<i class="la la-angle-double-left"></i>',
    //                 previous: '<i class="la la-angle-left"></i>',
    //                 next: '<i class="la la-angle-right"></i>',
    //                 last: '<i class="la la-angle-double-right"></i>'
    //             }
    //         },
    //         dom: "<'row'<'col-6'i><'col-6'l>>" +
    //         "<'row'<'col-sm-12'tr>>" +
    //         "<'row'<'col-4'i><'col-4'p><'col-4'l>>",
    //         "deferRender": true,
    //         /*
    //         "ajax": {
    //             url: "doc/documentList",
    //             "dataSrc": ""
    //         },
    //
    //         columns: [
    //             {
    //                 class: "details-control",
    //                 searchable: false,
    //                 orderable: false,
    //                 data: null,
    //                 defaultContent: ""
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: false,
    //                 data: function (data, type, full, meta) {
    //                     return "...";
    //                 }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: true,
    //                 name: 'documentDueDate',
    //                 data: 'documentDueDate',
    //                 render: function (data, type, full, meta) {
    //                     return data.documentDueDate !== null ? '<span class="text-danger">KОНТРОЛЬ<br>' + data.documentDueDate + '</span>' : '';
    //
    //                 }
    //             },
    //             {
    //                 searchable: true,
    //                 orderable: true,
    //                 name: 'docIndex',
    //                 data: 'receiverRegisteredNumber',
    //                 render: function (data) { return data; }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: true,
    //                 name: 'receiverRegisteredDate',
    //                 data: 'receiverRegisteredDate'
    //             },
    //             {
    //                 searchable: true,
    //                 orderable: true,
    //                 name: 'senderRegisteredNumber',
    //                 data: 'senderRegisteredNumber',
    //                 render: function (data, type, full, meta) {
    //                     return data.senderRegisteredNumber + "<hr>" + data.senderRegisteredDate;
    //                 }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: false,
    //                 name: 'senderResponsible',
    //                 data: 'senderResponsible',
    //                 render: function (data, type, full, meta) {
    //                     return data.senderResponsible !== null ? data.senderResponsible.join('') : null;
    //                 }
    //             },
    //             {
    //                 searchable: true,
    //                 orderable: false,
    //                 name: 'title',
    //                 data: 'title'
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: false,
    //                 name: 'receiverResponsible',
    //                 data: 'receiverResponsible'
    //                     //function (data, type, full, meta) { return data.receiverResponsible !== null ? data.receiverResponsible.join('') : null; }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: true,
    //                 name: 'documentState',
    //                 data: 'documentState'
    //             }
    //         ]
    //         */
    //
    //     };
    //     var table = $('#documentTable').DataTable(dtOptions);
    //
    //     /*
    //     <div class="m-input-icon m-input-icon--left">
    //         <input type="text" class="form-control m-input" th:placeholder="#{label.search}" id="generalSearch">
    //         <span class="m-input-icon__icon m-input-icon__icon--left">
    //             <span><i class="la la-search"></i></span>
    //         </span>
    //     </div>
    //     */
    //     /*
    //     var t1 = $('#incoming').DataTable({
    //         orderCellsTop: true,
    //         fixedHeader: true,
    //         searching: true,
    //         paging: true,
    //         processing: true,
    //         ajax: {
    //             url: '/doc/documents',
    //             data: function ( d ) {
    //                 d.documentType = [[${type}]];
    //             }
    //         },
    //         serverSide: true,
    //         order: [ [3, 'asc'] ],
    //         columns: [
    //             {
    //                 class: "details-control",
    //                 searchable: false,
    //                 orderable: false,
    //                 data: null,
    //                 defaultContent: ""
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: false,
    //                 data: function (data, type, full, meta) {
    //                     return "...";
    //                 }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: true,
    //                 name: 'documentDueDate',
    //                 data: function (data, type, full, meta) {
    //                     return data.documentDueDate !== null ? '<span class="text-danger">KОНТРОЛЬ<br>' + data.documentDueDate + '</span>' : '';
    //
    //                 }
    //             },
    //             {
    //                 searchable: true,
    //                 orderable: true,
    //                 name: 'docIndex',
    //                 data: 'receiverRegisteredNumber',
    //                 render: function (data) { return data; }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: true,
    //                 name: 'receiverRegisteredDate',
    //                 data: function (data, type, full, meta) {
    //                     return data.receiverRegisteredDate;
    //
    //                 }
    //             },
    //             {
    //                 searchable: true,
    //                 orderable: true,
    //                 name: 'senderRegisteredNumber',
    //                 data: function (data, type, full, meta) {
    //                     return data.senderRegisteredNumber + "<hr>" + data.senderRegisteredDate;
    //
    //                 }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: false,
    //                 name: 'senderResponsible',
    //                 data: function (data, type, full, meta) {
    //                     var r = [];
    //
    //                     if(data.senderResponsible !== null) {
    //
    //
    //                         if (data.senderResponsible.organizations != null) {
    //                             data.senderResponsible.organizations.forEach(function (element) {
    //                                 r.push(element.name)
    //                             });
    //                         }
    //
    //                         if (data.senderResponsible.person != null) {
    //                             data.senderResponsible.person.forEach(function (element) {
    //                                 r.push(element.name)
    //                             });
    //                         }
    //                     }
    //
    //                     return r.join('');
    //                 }
    //             },
    //             {
    //                 searchable: true,
    //                 orderable: false,
    //                 name: 'title',
    //                 data: 'title'
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: false,
    //                 name: 'receiverResponsible',
    //                 data: function (data, type, full, meta) {
    //
    //                     var r = [];
    //
    //                     data.receiverResponsible.staff.forEach(function(element) {
    //                         r.push(element.name + '<br>')
    //                     });
    //
    //                     return r.join('');
    //                 }
    //             },
    //             {
    //                 searchable: false,
    //                 orderable: true,
    //                 name: 'documentState',
    //                 data: function (data, type, full, meta) {
    //                     return data.documentState === "REGISTERED" || data.documentState === "DONE" ? "Зарегистрирован" : "";
    //                 }
    //             }
    //         ],
    //         language: {
    //             emptyTable: "<center>Нет данных</center>",
    //             info: "Всего _TOTAL_ записей",
    //             lengthMenu: "_MENU_",
    //             paginate: {
    //                 first: '<i class="la la-angle-double-left"></i>',
    //                 previous: '<i class="la la-angle-left"></i>',
    //                 next: '<i class="la la-angle-right"></i>',
    //                 last: '<i class="la la-angle-double-right"></i>'
    //             }
    //         },
    //         dom: "<'row'<'col-6'i><'col-6'l>>" +
    //         "<'row'<'col-sm-12'tr>>" +
    //         "<'row'<'col-4'i><'col-4'p><'col-4'l>>"
    //     });
    //
    //     var detailRows = [];
    //
    //     $('#incoming tbody').on( 'click', 'tr td.details-control', function () {
    //         var tr = $(this).closest('tr');
    //         var row = t1.row( tr );
    //         var idx = $.inArray( tr.attr('id'), detailRows );
    //
    //         if ( row.child.isShown() ) {
    //             tr.removeClass( 'details' );
    //             row.child.hide();
    //
    //             // Remove from the 'open' array
    //             detailRows.splice( idx, 1 );
    //         }
    //         else {
    //             tr.addClass( 'details' );
    //             row.child( format( row.data() ) ).show();
    //
    //             // Add to the 'open' array
    //             if ( idx === -1 ) {
    //                 detailRows.push( tr.attr('id') );
    //             }
    //         }
    //     } );
    //
    //     t1.on( 'draw', function () {
    //         $.each( detailRows, function ( i, id ) {
    //             $('#'+id+' td.details-control').trigger( 'click' );
    //         } );
    //     } );
    //
    //     /*
    //     $('#ddt thead tr').clone(true).appendTo( '#ddt thead' );
    //     $('#ddt thead tr:eq(1) th').each( function (i) {
    //
    //         $(this).html('<input type="text" class="form-control m-input m-input--solid">');
    //         $('input', this).on('keyup change', function (){
    //
    //             if (this.value.length > 2 && table.column(i).search() !== this.value) {
    //                 table.column(i)
    //                     .search(this.value)
    //                     .draw();
    //             }
    //         });
    //     });
    //     */
    //     /*
    //     l - perpage
    //     r - processing
    //     t - table
    //     i - info
    //     p - paging
    //     f - filter
    //     */
    //
    //
    //     $('#generalSearch').keyup(function(){
    //         table.search($(this).val()).draw() ;
    //     });
    // });

</script>


<script type="text/javascript" th:inline="javascript">
    var type = /*[[${type}]]*/ [];

    $('#sub_type').selectpicker();

    var DatatableJsonRemoteDemo = function () {
        //== Private functions
        // basic demovar
        var demo;
        if(type=="internal"){
            demo = function () {
                var datatable = $('.m_datatable').mDatatable({
                    // datasource definition
                    data: {
                        type: 'remote',
                        source: {
                            read: {
                                url: '/doc/documents/'+type
                            }
                        },
                        pageSize: 10,
                        saveState: {
                            cookie: false,
                            webstorage: false
                        },
                        serverPaging: true,
                        serverFiltering: true,
                        serverSorting: true
                    },

                    // layout definition
                    layout: {
                        theme: 'default', // datatable theme
                        class: '', // custom wrapper class
                        scroll: false, // enable/disable datatable scroll both horizontal and vertical when needed.
                        footer: false // display/hide footer
                    },
                    // column sorting
                    sortable: true,
                    // column based filtering
                    filterable: false,
                    pagination: true,
                    // columns definition
                    columns:  [{
                        field: "View",
                        width: 80,
                        textAlign: 'center',
                        title: '[[#{label.view}]]',
                        sortable: false,
                        selector: false,
                        overflow: 'visible',
                        template: function (row) {
                            var d='';
                            if(row.hasTask=="false"){
                                d=d+'\
                                <a  href="/doc/view/'+ row.id +'" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Просмотр "><i class="la la-arrow-circle-o-right"></i></a>\
                            ';
                            }
                            else{
                                d=d+'\
                                <a  href="/doc/edit/'+ row.id +'" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Редактировать "><i class="la la-edit"></i></a>\
                            ';
                            }
                            return d;
                        }
                    },{
                        field: "id",
                        title: "#",
                        sortable: 'desc',
                        responsive: {hidden: 'xl'}
                    },{
                        field: "docIndex",
                        title: "№",
                        template:function (row) {
                            return row.docIndex+1;
                        }
                    },{
                        field: "documentDueDate",
                        title: "Date"
                    },{
                        field: "title",
                        title: 'title',
                        template: function (row) {
                            var d = row.title;
                            var t=row.documentSubType;
                            if(d.length>30){
                                d= d.substring(0,30)+"...";
                            }
                            return t+" "+d;
                        }
                    },{
                        field: "senderResponsible",
                        title: 'Исх. № и Дата',
                        template: function (row) {
                            var d = row.senderRegisteredNumber;
                            var t=row.senderRegisteredDate;
                            if(d.length>30){
                                d= d.substring(0,30)+"...";
                            }
                            return d+" "+t;
                        }
                    },{
                        field: "senderResponsible",
                        title: 'Отправитель'
                    },{
                        field: "receiverResponsible",
                        title: 'Вхд. № и Дата',
                        template: function (row) {
                            var d = row.receiverRegisteredNumber;
                            var t=row.receiverRegisteredDate;
                            if(d.length>30){
                                d= d.substring(0,30)+"...";
                            }
                            return d+" "+t;
                        }
                    }, {
                        field: "receiverResponsible",
                        title: 'Исполнитель',
                    }, {
                        field: "documentDueDate",
                        title: 'Срок',
                    }],
                    translate: {
                        records: {
                            processing: 'Подождите пожалуйста...',
                            noRecords: 'Записей не найдено'
                        },
                        toolbar: {
                            pagination: {
                                items: {
                                    default: {
                                        first: 'Первая страница',
                                        prev: 'Предыдущая страница',
                                        next: 'Следующая страница',
                                        last: 'Последняя страница',
                                        more: 'Другие страницы',
                                        input: 'Номер страницы',
                                        select: 'Выбрать размер страницы'
                                    },
                                    info: 'Отображение {{start}} - {{end}} из {{total}} записей'
                                }
                            }
                        }
                    }
                });


                var query = datatable.getDataSourceQuery();

                $('#sub_type').on('change', function () {
                    datatable.search($(this).val(), 'docType');
                }).val(typeof query.docType !== 'undefined' ? query.docType : '');

                $('#from_date').on('change', function () {
                    datatable.search($(this).find("input").val(), 'fromDate');
                }).val(typeof query.fromDate!== 'undefined' ? query.fromDate: '');

                $('#to_date').on('change', function () {
                    datatable.search($(this).find("input").val(), 'toDate');
                }).val(typeof query.toDate!== 'undefined' ? query.toDate: '');

                $('#title').on('keyup', function () {
                    datatable.search($(this).val(), 'title');
                }).val(typeof query.title!== 'undefined' ? query.title: '');

                $('#sender').on('keyup', function () {
                    datatable.search($(this).val(), 'sender');
                }).val(typeof query.sender!== 'undefined' ? query.sender: '');

                $('#receiver').on('keyup', function () {
                    datatable.search($(this).val(), 'receiver');
                }).val(typeof query.receiver!== 'undefined' ? query.receiver: '');
            };
        }
        else if(type=="incoming"){
            demo = function () {
                var datatable = $('.m_datatable').mDatatable({
                    // datasource definition
                    data: {
                        type: 'remote',
                        source: {
                            read: {
                                url: '/doc/documents/'+type
                            }
                        },
                        pageSize: 10,
                        saveState: {
                            cookie: false,
                            webstorage: false
                        },
                        serverPaging: true,
                        serverFiltering: true,
                        serverSorting: true
                    },

                    // layout definition
                    layout: {
                        theme: 'default', // datatable theme
                        class: '', // custom wrapper class
                        scroll: false, // enable/disable datatable scroll both horizontal and vertical when needed.
                        footer: false // display/hide footer
                    },
                    // column sorting
                    sortable: true,
                    // column based filtering
                    filterable: false,
                    pagination: true,
                    // columns definition
                    columns:  [{
                        field: "View",
                        width: 50,
                        textAlign: 'center',
                        title: '[[#{label.view}]]',
                        sortable: false,
                        selector: false,
                        overflow: 'visible',
                        template: function (row) {
                            var d='';
                            console.log(row.hasTask=="false")
                            if(row.hasTask=="false"){
                                d=d+'\
                                <a  href="/doc/view/'+ row.id +'" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Просмотр "><i class="la la-arrow-circle-o-right"></i></a>\
                            ';
                            }
                            else{
                                d=d+'\
                                <a  href="/doc/edit/'+ row.id +'" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Редактировать "><i class="la la-edit"></i></a>\
                            ';
                            }
                            return d;
                        }
                    },{
                        field: "id",
                        title: "#",
                        sortable: 'desc',
                        responsive: {hidden: 'xl'}
                    },{
                        field: "documentDueDate",
                        title: "КОНТРОЛЬ",
                        template:function(row){
                            var date='';
                            if(row.documentDueDate!=null)
                                date = moment("/Date("+row.documentDueDate+")/").format("DD.MM.YYYY");
                            return date;
                        }
                    },{
                        field: "receiverRegisteredNumber",
                        title: 'Вхд. №'
                    },{
                        field: "receiverRegisteredDate",
                        title: "Вхд. Дата",
                        width:80
                    },{
                        field: "senderRegisteredNumber",
                        title: 'Исх. № '
                    },{
                        field: "senderRegisteredDate",
                        title: "Исх. Дата",
                        width:80
                    },{
                        field: "senderResponsible",
                        title: 'Отправитель'
                    },{
                        field: "title",
                        title: 'Относительно',
                        width:270,
                        template: function (row) {
                            var d = row.title;
                            var t=row.documentSubType;
                            if(d.length>30){
                                d= d.substring(0,30)+"...";
                            }
                            return t+" "+d;
                        }
                    }, {
                        field: "receiverResponsible",
                        title: 'Получатель',
                        width:270
                    },{
                        field: "documentState",
                        title: 'Состояние'
                    }],
                    translate: {
                        records: {
                            processing: 'Подождите пожалуйста...',
                            noRecords: 'Записей не найдено'
                        },
                        toolbar: {
                            pagination: {
                                items: {
                                    default: {
                                        first: 'Первая страница',
                                        prev: 'Предыдущая страница',
                                        next: 'Следующая страница',
                                        last: 'Последняя страница',
                                        more: 'Другие страницы',
                                        input: 'Номер страницы',
                                        select: 'Выбрать размер страницы'
                                    },
                                    info: 'Отображение {{start}} - {{end}} из {{total}} записей'
                                }
                            }
                        }
                    }
                });


                var query = datatable.getDataSourceQuery();

                $('#sub_type').on('change', function () {
                    datatable.search($(this).val(), 'docType');
                }).val(typeof query.docType !== 'undefined' ? query.docType : '');

                $('#from_date').on('change', function () {
                    datatable.search($(this).find("input").val(), 'fromDate');
                }).val(typeof query.fromDate!== 'undefined' ? query.fromDate: '');

                $('#to_date').on('change', function () {
                    datatable.search($(this).find("input").val(), 'toDate');
                }).val(typeof query.toDate!== 'undefined' ? query.toDate: '');

                $('#title').on('keyup', function () {
                    datatable.search($(this).val(), 'title');
                }).val(typeof query.title!== 'undefined' ? query.title: '');

                $('#sender').on('keyup', function () {
                    datatable.search($(this).val(), 'sender');
                }).val(typeof query.sender!== 'undefined' ? query.sender: '');

                $('#receiver').on('keyup', function () {
                    datatable.search($(this).val(), 'receiver');
                }).val(typeof query.receiver!== 'undefined' ? query.receiver: '');
            };
        }
        else{
            demo = function () {
                var datatable = $('.m_datatable').mDatatable({
                    // datasource definition
                    data: {
                        type: 'remote',
                        source: {
                            read: {
                                url: '/doc/documents/'+type
                            }
                        },
                        pageSize: 10,
                        saveState: {
                            cookie: false,
                            webstorage: false
                        },
                        serverPaging: true,
                        serverFiltering: true,
                        serverSorting: true
                    },

                    // layout definition
                    layout: {
                        theme: 'default', // datatable theme
                        class: '', // custom wrapper class
                        scroll: false, // enable/disable datatable scroll both horizontal and vertical when needed.
                        footer: false // display/hide footer
                    },
                    // column sorting
                    sortable: true,
                    // column based filtering
                    filterable: false,
                    pagination: true,
                    // columns definition
                    columns:  [{
                        field: "View",
                        width: 50,
                        textAlign: 'center',
                        title: '  ',
                        sortable: false,
                        selector: false,
                        overflow: 'visible',
                        template: function (row) {
                            var d='';
                            if(row.hasTask=="false"){
                                d=d+'\
                                <a  href="/doc/view/'+ row.id +'" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Просмотр "><i class="la la-arrow-circle-o-right"></i></a>\
                            ';
                            }
                            else{
                                d=d+'\
                                <a  href="/doc/edit/'+ row.id +'" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Редактировать "><i class="la la-edit"></i></a>\
                            ';
                            }
                            return d;
                        }
                    },{
                        field: "id",
                        title: "#",
                        sortable: 'desc',
                        responsive: {hidden: 'xl'}
                    },{
                        field: "title",
                        title: "Относительно"
                    },{
                        field: "senderRegisteredNumber",
                        title: 'Исх. № <br> Дата',
                        template: function (row) {
                            var d = row.senderRegisteredNumber;
                            var t=row.senderRegisteredDate;
                            if(d.length>30){
                                d= d.substring(0,30)+"...";
                            }
                            return d+" "+t;
                        }
                    },{
                        field: "senderRegisteredDate",
                        title: "Исх. ",
                        width:80
                    },{
                        field: "senderResponsible",
                        title: 'Отправитель'
                    },{
                        field: "title",
                        title: [[#{label.document.title}]],
                        width:270,
                        template: function (row) {
                            var d = row.title;
                            var t=row.documentSubType;
                            if(d.length>30){
                                d= d.substring(0,30)+"...";
                            }
                            return t+" "+d;
                        }
                    },{
                        field: "documentState",
                        title: [[#{label.document.generalStatus}]]
                    },{
                        field: "receiverResponsible",
                        title: 'Исполнитель',
                    },  {
                        field: "receiverResponsible",
                        title: 'Получатель',
                        width:270
                    }, {
                        field: "pageCount",
                        title: [[#{label.document.pageIndex}]]+"<br>"+[[#{label.document.pageCount}]],
                        template:function (row) {
                            return row.indexNo+" - "+row.pageCount;
                        }
                    }],
                    translate: {
                        records: {
                            processing: 'Подождите пожалуйста...',
                            noRecords: 'Записей не найдено'
                        },
                        toolbar: {
                            pagination: {
                                items: {
                                    default: {
                                        first: 'Первая страница',
                                        prev: 'Предыдущая страница',
                                        next: 'Следующая страница',
                                        last: 'Последняя страница',
                                        more: 'Другие страницы',
                                        input: 'Номер страницы',
                                        select: 'Выбрать размер страницы'
                                    },
                                    info: 'Отображение {{start}} - {{end}} из {{total}} записей'
                                }
                            }
                        }
                    }
                });


                var query = datatable.getDataSourceQuery();

                $('#sub_type').on('change', function () {
                    datatable.search($(this).val(), 'docType');
                }).val(typeof query.docType !== 'undefined' ? query.docType : '');

                $('#from_date').on('change', function () {
                    datatable.search($(this).find("input").val(), 'fromDate');
                }).val(typeof query.fromDate!== 'undefined' ? query.fromDate: '');

                $('#to_date').on('change', function () {
                    datatable.search($(this).find("input").val(), 'toDate');
                }).val(typeof query.toDate!== 'undefined' ? query.toDate: '');

                $('#title').on('keyup', function () {
                    datatable.search($(this).val(), 'title');
                }).val(typeof query.title!== 'undefined' ? query.title: '');

                $('#sender').on('keyup', function () {
                    datatable.search($(this).val(), 'sender');
                }).val(typeof query.sender!== 'undefined' ? query.sender: '');

                $('#receiver').on('keyup', function () {
                    datatable.search($(this).val(), 'receiver');
                }).val(typeof query.receiver!== 'undefined' ? query.receiver: '');
            };
        }
        return {
            // public functions
            init: function () {
                demo();
            }
        };
    }();
    jQuery(document).ready(function () {
        DatatableJsonRemoteDemo.init();
    });
</script>
<script>
    $('#from_date').datetimepicker({
        format: "dd.mm.yyyy",
        todayHighlight: true,
        autoclose: true,
        startView: 2,
        minView: 2,
        forceParse: 0,
        pickerPosition: 'bottom-left'
    });
    $('#to_date').datetimepicker({
        format: "dd.mm.yyyy",
        todayHighlight: true,
        autoclose: true,
        startView: 2,
        minView: 2,
        forceParse: 0,
        pickerPosition: 'bottom-left'
    });
</script>
</body>
<!-- end::Body -->
</html>

