<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<body>
    <th:block th:fragment="hiddenFields">
        <div hidden="hidden">
            <input type="hidden" th:field="*{id}"/>
            <input type="hidden" th:field="*{version}"/>
            <input type="hidden" th:field="*{uuid}"/>
            <input type="hidden" th:field="*{owner}"/>
            <input type="hidden" th:field="*{documentState}"/>
            <input type="hidden" th:field="*{documentType.id}"/>
            <input type="hidden" th:field="*{documentSubType.id}"/>
        </div>
    </th:block>
    <th:block th:fragment="script">
        <script type="text/javascript" th:inline="javascript">

            function davay() {
                $('#pick').modal('hide')
            }

            $(document).ready(function() {

                CKEDITOR.config.readOnly = [[${document.documentState.ordinal()}]] > 4;
                CKEDITOR.replace("description", {
                    language: 'ru',
                    uiColor: '#ffffff',
                    toolbar: [
                        { name: 'clipboard', groups: [ 'clipboard' ], items: [ 'Cut', 'Copy', 'Paste', 'PasteFromWord' ] },
                        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic', 'Underline', 'Strike' ] },
                        { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ], items: [ 'NumberedList', 'BulletedList', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock' ] },
                        { name: 'insert', items: [ 'Image', 'Table' ] },
                        { name: 'styles', items: [ 'Font', 'FontSize' ] },
                        { name: 'tools', items: [ 'Maximize' ] }
                    ],
                    toolbarGroups: [
                        { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },
                        { name: 'forms' },
                        '/',
                        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },
                        { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align' ] },
                        { name: 'insert' },
                        '/',
                        { name: 'styles' },
                        { name: 'tools' }
                    ]
                });

                var dt_settings = {
                    autoclose: true,
                    minView : 2,
                    maxView : 2,
                    format : 'dd-mm-yyyy hh:ii'
                };
                $('.dtp').datetimepicker(dt_settings);
                $('.sdr').hide();
                $('.rdr').hide();

                if($('#id').val() > 0 || $('#id').val() != null) {
                    $('#si' + $('#srt_select').val()).show();
                    $('#ri' + $('#rrt_select').val()).show();
                }

                $('#srt_select').change(function(){
                    $('#si' + $(this).val()).find( "select" ).val('').trigger('change')
                    $('.sdr ').hide();
                    $('#si' + $(this).val()).show();
                });
                $('#rrt_select').change(function(){
                    $('#ri' + $(this).val()).find( "select" ).val('').trigger('change')
                    $('.rdr ').hide();
                    $('#ri' + $(this).val()).show();
                });

                var soption = {
                    minimumInputLength: 2,
                    placeholder: "Выбрать",
                    language: {
                        inputTooShort: function () {
                            return "";
                        },
                        noResults: function () {
                            return "Не найден";
                        },
                        searching: function () {
                            return "";
                        },
                    },
                    ajax: {
                        data: function (params) {
                            var query = {
                                name: params.term
                            }
                            return query;
                        },
                        processResults: function (data) {
                            return {
                                results : data
                            };
                        }
                    }
                }
                var ssoption = {
                    minimumResultsForSearch: -1,
                    placeholder: "Выбрать",
                    language: {
                        inputTooShort: function () {
                            return "";
                        },
                        noResults: function () {
                            return "Не найден";
                        },
                        searching: function () {
                            return "";
                        }
                    }
                }

                $('.s2 ').select2(soption);
                $('.s2s ').select2(ssoption);
                $('#tabstages a').on('click', function (e) {
                    e.currentTarget.id == "nav-main-tab" ? $(".act").show() : $(".act").hide()
                })
            });

            function doClick(side) {
                var el = document.getElementById(side);
                if (el) {
                    el.click();
                }
            }
            function handleFiles(files, side) {

                var filesList = document.getElementById(side);

                $("#" + side + " tr").remove();

                if (files.length)
                {
                    filesList.style.display = "block"

                    for (var i=0; i < files.length; i++) {

                        var tr = document.createElement("tr");
                        filesList.appendChild(tr);

                        var td = document.createElement("td");
                        tr.appendChild(td);

                        var info = document.createElement("label");
                        info.innerHTML = files[i].name;
                        td.appendChild(info);
                    }
                }
                else
                {
                    filesList.style.display = "none"
                }
            }
        </script>
    </th:block>
    <th:block th:fragment="history">
        <div class="form-group m-form__group">
            <table class="table table-bordered table-striped">
                <thead class="bg-info">
                <tr>
                    <th class="align-middle m-2 text-white" width="auto">Дата</th>
                    <th class="align-middle m-2 text-white">От</th>
                    <th class="align-middle m-2 text-white">Задачи</th>
                    <th class="align-middle m-2 text-white">Кому</th>
                    <th class="align-middle m-2 text-white">Результат</th>
                    <th class="align-middle m-2 text-white" width="auto">Завершен</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="task : ${tasks}">
                    <td><label class="align-middle m-2" th:text= "${#dates.format(task.createdOn, 'dd-MM-yyyy')}"></label></td>
                    <td><label class="align-middle m-2" th:utext="${task.createdBy != null } ? ${task.createdBy.staff.name} : 'Система'"></label></td>
                    <td><label class="align-middle m-2" th:utext="${task.description}"></label></td>
                    <td><label class="align-middle m-2" th:utext="${task.assignedTo.staff.name}"></label></td>
                    <td><label class="align-middle m-2" th:utext="${task.resolutionSummary}"></label></td>
                    <td><label class="align-middle m-2" th:text= "${#dates.format(task.actualResolutionDate, 'dd-MM-yyyy')}"></label></td>
                </tr>
                </tbody>
            </table>

        </div>
    </th:block>
    <th:block th:fragment="journal">
        <div class="form-group m-form__group">
            <table class="table table-bordered table-striped">
                <thead class="bg-info">
                <tr>
                    <th class="align-middle m-2 text-white">Дата</th>
                    <th class="align-middle m-2 text-white">Пользователь</th>
                    <th class="align-middle m-2 text-white">Действие</th>
                    <th class="align-middle m-2 text-white">Примечание</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="dd : *{dispatchData}">
                    <td><label class="align-middle m-2" th:text="${#dates.format(dd.dispatchInitTime, 'dd-MM-yyyy HH:mm')}"></label></td>
                    <td><label class="align-middle m-2" th:text="${dd.dispatchBy.staff.name}"></label></td>
                    <td><label class="align-middle m-2" th:text="${dd.dispatchType.text()}"></label></td>
                    <td><label class="align-middle m-2" th:utext="${dd.description}"></label></td>
                </tr>
                </tbody>
            </table>
        </div>
    </th:block>
    <th:block th:fragment="documentActions">
        <button style="margin: 3px"
                class="act btn btn-success"
                name="action"
                th:each="action : ${actions}"
                th:value="${action.name()}"
                th:text="${action.text()}"
                th:type="${action.toString() == 'TORECONCILE' or action.toString() == 'SEND'} ? 'button' : 'submit'"
                th:attr="data-toggle=${action.toString() == 'TORECONCILE' or action.toString() == 'SEND'} ? 'modal' : '', data-target=${action.toString() == 'TORECONCILE' or action.toString() == 'SEND'} ? '#pick' : ''">
        </button>
    </th:block>
</body>
</html>