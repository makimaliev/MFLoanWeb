<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<body>
    <th:block th:fragment="hiddenFields">
        <div hidden="hidden">
            <input type="hidden" th:field="*{id}"/>
            <input type="hidden" th:field="*{version}"/>
            <input type="hidden" th:field="*{uuid}"/>
            <input type="hidden" th:field="*{owner}"/>
            <input type="hidden" th:field="*{documentState}"/>
            <input type="hidden" th:field="*{documentType.id}"/>
            <input type="hidden" th:field="*{documentSubType.id}"/>
            <!--input type="hidden" th:field="*{reconciler}"/-->
        </div>
    </th:block>
    <th:block th:fragment="script">
        <script type="text/javascript" th:inline="javascript">

            function davay() {
                $('#pick').modal('hide')
            }

            var dt_settings = {
                autoclose: true,
                minView : 2,
                maxView : 2,
                format : 'dd-mm-yyyy hh:ii'
            };

            $(document).ready(function() {

                CKEDITOR.config.readOnly = [[${document.documentState.ordinal()}]] > 1;
                CKEDITOR.replace("description", {
                    language: 'ru',
                    uiColor: '#ffffff',
                    toolbar: [
                        { name: 'clipboard', groups: [ 'clipboard' ], items: [ 'Cut', 'Copy', 'Paste', 'PasteFromWord' ] },
                        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic', 'Underline', 'Strike' ] },
                        { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ], items: [ 'NumberedList', 'BulletedList', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock' ] },
                        { name: 'insert', items: [ 'Image', 'Table' ] },
                        '/',
                        { name: 'styles', items: [ 'Font', 'FontSize' ] },
                        { name: 'tools', items: [ 'Maximize' ] }
                    ],
                    toolbarGroups: [
                        { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },
                        { name: 'forms' },
                        '/',
                        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },
                        { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align' ] },
                        { name: 'insert' },
                        '/',
                        { name: 'styles' },
                        { name: 'tools' }
                    ]
                });

                $('.dtp').datetimepicker(dt_settings);

                $('.sdr').hide();
                $('.rdr').hide();

                if($('#id').val() > 0 || $('#id').val() != null) {
                    $('#si' + $('#srt_select').val()).show();
                    $('#ri' + $('#rrt_select').val()).show();
                }

                $('#srt_select').change(function(){
                    $('#si' + $(this).val()).find( "select" ).val('').trigger('change')
                    $('.sdr ').hide();
                    $('#si' + $(this).val()).show();
                });
                $('#rrt_select').change(function(){
                    $('#ri' + $(this).val()).find( "select" ).val('').trigger('change')
                    $('.rdr ').hide();
                    $('#ri' + $(this).val()).show();
                });

                var soption = {
                    language: "ru",
                    minimumInputLength: 2,
                    ajax: {
                        data: function (params) {
                            var query = {
                                name: params.term
                            }
                            return query;
                        },
                        processResults: function (data) {
                            return {
                                results : data
                            };
                        }
                    }
                }

                $('#srs').select2(soption);
                $('#sro').select2(soption);
                $('#srp').select2(soption);
                $('#rrs').select2(soption);
                $('#rrd').select2(soption);
                $('#rro').select2(soption);
                $('#rrp').select2(soption);
                $('#res').select2(soption);

                $('#rr').select2(soption);
            });

            function doClick(side) {
                var el = document.getElementById(side);
                if (el) {
                    el.click();
                }
            }
            function handleFiles(files, side) {

                var filesList = document.getElementById(side);

                $("#" + side + " tr").remove();

                if (files.length)
                {
                    filesList.style.display = "block"

                    for (var i=0; i < files.length; i++) {

                        var tr = document.createElement("tr");
                        filesList.appendChild(tr);

                        var td = document.createElement("td");
                        tr.appendChild(td);

                        var info = document.createElement("label");
                        info.innerHTML = files[i].name;
                        td.appendChild(info);
                    }
                }
                else
                {
                    filesList.style.display = "none"
                }
            }
        </script>
    </th:block>
    <th:block th:fragment="history">
        <div class="form-group m-form__group">
            <table class="table table-bordered" id="documentTable">
                <thead class="thead-default">
                <tr>
                    <th width="auto">Дата</th>
                    <th>От</th>
                    <th>Задачи</th>
                    <th>Кому</th>
                    <th>Результат</th>
                    <th width="auto">Завершен</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="task : ${tasks}">
                    <td th:text= "${#dates.format(task.createdOn, 'dd-MM-yyyy')}"></td>
                    <td th:utext="${task.createdBy != null } ? ${task.createdBy.staff.name} : 'Автоматическое задание'"> Автоматическое задание </td>
                    <td th:utext="${task.description}"></td>
                    <td th:utext="${task.assignedTo.staff.name}"></td>
                    <td th:utext="${task.resolutionSummary}"></td>
                    <td th:text= "${#dates.format(task.actualResolutionDate, 'dd-MM-yyyy')}"></td>
                </tr>
                </tbody>
            </table>

        </div>
    </th:block>
    <th:block th:fragment="journal">
        <div class="form-group m-form__group">
            <table class="table table-bordered" id="documentTable">
                <thead class="thead-default">
                <tr>
                    <th width="130px">Дата</th>
                    <th>Пользователь</th>
                    <th>Действие</th>
                    <th>Примечание</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="dd : *{dispatchData}">
                    <td th:text= "${#dates.format(dd.dispatchInitTime, 'dd-MM-yyyy HH:mm')}"></td>
                    <td th:text= "${dd.dispatchBy.staff.name}"></td>
                    <td th:text= "${dd.dispatchType.text()}"></td>
                    <td th:utext="${dd.description}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </th:block>
    <th:block th:fragment="documentActions">
        <button type="button" class="btn btn-primary" onclick="window.history.back()"> Отмена </button>
        <button style="margin: 3px"
                class="btn btn-success"
                name="action"
                th:each="action : ${actions}"
                th:value="${action.name()}"
                th:text="${action.text()}"
                th:type="${action.toString() == 'TORECONCILE' or action.toString() == 'SEND'} ? 'button' : 'submit'"
                th:attr="data-toggle=${action.toString() == 'TORECONCILE' or action.toString() == 'SEND'} ? 'modal' : '', data-target=${action.toString() == 'TORECONCILE' or action.toString() == 'SEND'} ? '#pick' : ''">
        </button>
    </th:block>
</body>
</html>